<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: OpenCPN Manuals</title>
    <link rel="canonical" href="https://opencpn-manuals.github.io/plugins/opencpn-beta-plugins/0.1/javascript/javascript.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <div class="navbar">
    <div class="navbar-brand">
      <div class="ocpn-logo"> </div>
      <a class="navbar-title"
         href="https://opencpn-manuals.github.io/plugins"
      >
        OpenCPN Manuals
        </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
       <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
              <a class="navbar-item" href="https://www.opencpn.org/">
                OpenCPN.org
              </a>
              <a class="navbar-item" href="https://opencpn.org/wiki/dokuwiki/doku.php?id&#x3D;opencpn:opencpn_user_manual">
                User Manual
              </a>
              <a class="navbar-item" href="https://github.com/opencpn/OpenCPN">
                Github Site
              </a>
              <a class="navbar-item" href="https://opencpn.org/flyspray/">
                Bugtracker
              </a>
              <a class="navbar-item" href="https://opencpn-manuals.github.io/plugins/">
                Plugin Manual (WIP)
              </a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="opencpn-beta-plugins" data-version="0.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">OpenCPN Beta Plugins</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../index.html">Home Page</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../beta-plugins.html">Beta Plugins</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">OpenCPN Beta Plugins</span>
    <span class="version">0.1</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../ais_radar_display/0.1/ais_radar_display.html">ais_radar_display</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ais_radar_display/0.1/ais_radar_display.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../autotrackraymarine/0.1/index.html">autotrackraymarine</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../autotrackraymarine/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../chartscale/0.1/chartscale.html">chartscale</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../chartscale/0.1/chartscale.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../debugger/0.1/index.html">debugger</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../debugger/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../deviation/0.1/index.html">Deviation</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../deviation/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../dead_reckoning/0.1/dead_reckoning.html">DR</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../dead_reckoning/0.1/dead_reckoning.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../earthexplorer/0.1/earthexplorer.html">EarthExplorer</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../earthexplorer/0.1/earthexplorer.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../engine-dash/0.1/index.html">EngineDashboard</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../engine-dash/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../googleearth/0.1/index.html">Google Earth</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../googleearth/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../iacfleet/0.1/index.html">iacfleet</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../iacfleet/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../launcher/0.1/index.html">launcher</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../launcher/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../nmea_converter/0.1/index.html">NMEA Converter</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../nmea_converter/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../objsearch/0.1/objsearch.html">objsearch</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../objsearch/0.1/objsearch.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../odometer/0.1/index.html">odometer</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../odometer/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../oesenc/0.1/index.html">oesenc</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../oesenc/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">OpenCPN Beta Plugins</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../opencpn-plugins/0.1/index.html">OpenCPN Plugins</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../opencpn-plugins/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../otcurrent/0.1/otcurrent.html">otcurrent</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../otcurrent/0.1/otcurrent.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../otidalplan/0.1/otidalplan.html">otidalplan</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../otidalplan/0.1/otidalplan.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../photolayer/0.1/photolayer.html">PhotoLayer</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../photolayer/0.1/photolayer.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../race-start/0.1/index.html">RaceStart</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../race-start/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../radar/0.1/index.html">Radar Manual</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../radar/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../s63_vector_charts/0.1/index.html">s63_vector_charts</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../s63_vector_charts/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../sailawaynmea/0.1/sailawaynmea.html">SailawayNMEA</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../sailawaynmea/0.1/sailawaynmea.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../sar/0.1/sar.html">SAR</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../sar/0.1/sar.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../shipdriver/0.1/shipdriver.html">ShipDriver</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../shipdriver/0.1/shipdriver.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../survey/0.1/survey.html">Survey</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../survey/0.1/survey.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../tidefinder/0.1/tidefinder.html">TideFinder</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../tidefinder/0.1/tidefinder.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../twocan/0.1/index.html">TwoCan Plugin</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../twocan/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../uktides/0.1/uktides.html">UKtides</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../uktides/0.1/uktides.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../vdr/0.1/index.html">vdr</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../vdr/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../vfkaps/0.1/index.html">vfkaps</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../vfkaps/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../watchdog/2.4.29/watchdog.html">Watchdog</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../watchdog/2.4.29/watchdog.html">2.4.29</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../opencpn-plugins/0.1/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/opencpn-manuals/plugins/edit/build/manual/beta-plugins/modules/javascript/pages/javascript.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect1">
<h2 id="_javascript_plugin"><a class="anchor" href="#_javascript_plugin"></a>Javascript Plugin</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image"><img src="_images/js_icon_full_size_.png" alt="js icon full size "></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_javascript"><a class="anchor" href="#_javascript"></a>JavaScript</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_aim"><a class="anchor" href="#_aim"></a>Aim</h3>
<div class="paragraph">
<p>To provide a scriptable plugin that allows users to tailor the
functioning of OpenCPN without getting into the complexity of writing a
plugin.</p>
</div>
<div class="paragraph">
<p><a href="assets/JavaScript%20plugin%20user%20guide.pdf">Javascript plugin user guide</a></p>
</div>
<div class="paragraph">
<p><a href="https://github.com/antipole2/JavaScript_pi/blob/master/documentation/JavaScript%20plugin%20user%20guide.pdf">Complete
User Guide</a><br>
<a href="https://github.com/antipole2/JavaScript_pi/releases">Releases (including
installers)</a><br>
<a href="https://github.com/antipole2/JavaScript_pi">Github Repository</a><br>
<a href="https://www.cruisersforum.com/forums/f134/javascript-plugin-235728.html">Cruisers
Forum Thread</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_how_does_it_work"><a class="anchor" href="#_how_does_it_work"></a>How does it work?</h3>
<div class="paragraph">
<p>The plugin presents a console window comprising a script pane and a
results pane and some buttons. You enter your JavaScript in the script
pane (or load it from a file) and click on the Run button. The script is
compiled into byte code and executed and any result is displayed. At its
simplest, enter, say</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-code hljs" data-lang="code">(4+8)/3</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the result 4 is displayed. But you could also enter, say</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-code hljs" data-lang="code">function fib(n) {
    if (n == 0) { return 0; }
    if (n == 1) { return 1; }
    return fib(n-1) + fib(n-2);
}
function build(n) {
    var res = [];
    for (i = 0; i &lt;n; i++) {
        res.push(fib(i));
    }
    return(res.join(' '));
}

print("Fibonacci says: ", build(20), “\n");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which displays</p>
</div>
<div class="paragraph">
<p>Fibonacci says: 0 1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597
2584 4181</p>
</div>
<div class="paragraph">
<p>This illustrates how functions can be defined and called, including
recursively. So we have a super calculator!</p>
</div>
<div class="paragraph">
<p>I have been developing interfaces (APIs) to OpenCPN and it is here that
the fun starts. As an example, the following statement takes the
supplied NMEA sentence, adds a checksum (replacing any existing one) and
pushes it out over the OpenCPN connections</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-code hljs" data-lang="code">OCPNpushNMEA(“$OCRMB,A,0.000,L,,Yarmouth,5030.530,N,00120.030,W,
       15.386,82.924,0.000,5030.530,S,00120.030,E,V");</code></pre>
</div>
</div>
<div class="paragraph">
<p>A challenge has been how to arrange for the processing of OpenCPN
events. I have developed a way of specifying a function to handle a
particular event, so we can write, for example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-code hljs" data-lang="code">OCPNonNMEAsentence(handleNMEA);

function handleNMEA(result){
    if(result.OK){
    print(“Received: “, result.value, “\n”);
        }
    else print(“Bad checksum\n”);
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This listens out for the next NMEA sentence and displays it on receipt
if the checksum is OK.</p>
</div>
</div>
<div class="sect2">
<h3 id="_structures_and_methods"><a class="anchor" href="#_structures_and_methods"></a>Structures and methods</h3>
<div class="paragraph">
<p>JavaScript supports the use of structures and methods. I have created
structures to represent positions, waypoints and routes. You can write
something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-code hljs" data-lang="code">myposition = new Position(50.234, 3.231);
// let’s change the longitude
myposition.longitude = -1.674;
print(“My position is “, myPosition.formatted, ‘\n”);
// displays //My position is 50º 14.040’N 001º 40.440’W</code></pre>
</div>
</div>
<div class="paragraph">
<p>mypos.NMEA returns the string 5014.04,N,140.44,W, which is the very odd
way positions are represented in NMEA sentences.</p>
</div>
<div class="paragraph">
<p>This structure includes methods, as illustrated here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-code hljs" data-lang="code">sentence = "$OCRMB,A,0.000,L,,UK-S:Y,5030.530,N,00120.030,W,15.386,82.924,
0.000,5030.530,S,00120.030,E,V,A*69";
myPosition.NMEAdecode(sentence,1); // decodes NMEA sentence and sets
print(mypos.formatted, “\n"); //  displays 50º 30.530’N 001º 20.030’W
myPosition.latest(); // sets myPosition to the latest available from OpenCPN
print("My latest position is", myPosition.formatted, "\n");
// might display My latest position is 50º 23.50’N 001º 41.234’W</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>

</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="_a_simple_application"><a class="anchor" href="#_a_simple_application"></a>A simple application</h3>
<div class="paragraph">
<p>As an illustrative application, I note that @arnolddemaa was having
problems capturing magnetic variation from HDG sentences and inserting
into RMC sentences. Here is a solution which captures the variation from
HDG sentences and inserts it into any RMC sentences that do not already
have the variation. It changes the RMC sender identity so that the
originals can be blocked by OpenCPN filtering. It works by splitting the
sentence into an array of fields. Note how it ends by setting up to
process the next NMEA sentence.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-code hljs" data-lang="code">// insert magnetic variation into RMC sentence
var vardegs = "";    // where we will save the latest variation
var varEW = "";
OCPNonNMEAsentence(processNMEA);

function processNMEA(result){
    if (result.OK){
        sentence = result.value;
        switch (sentence.slice(3,6)){
            case “HDG:"  // capture variation
                splut = sentence.split(",");
                vardegs = splut[4];    varEW = splut[5];
                break;
            case "RMC":
                splut = sentence.split(",");
                if (splut[10] == "") { // if no variation already
                    splut[10] = vardegs; splut[11] = varEW;
                    splut[0] = “$JSRMC”;
                        }
                result = splut.join(“,"); // put sentence together
                OCPNpushNMEA(result);
                break;
            }
        }
    OCPNonNMEAsentence(processNMEA);
    };</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_opencpn_messaging"><a class="anchor" href="#_opencpn_messaging"></a>OpenCPN Messaging</h3>
<div class="paragraph">
<p>I have implemented APIs to handle OpenCPN messages. Different messages
can be directed to message-specific functions. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-code hljs" data-lang="code">//request route list
routeRequest = '{"mode": "Not track"}'   // JSON needed to get route
OCPNonMessageName(handleRL, “OCPN_ROUTELIST_RESPONSE”);
OCPNsendMessage("OCPN_ROUTELIST_REQUEST", routeRequest);

function handleRL(routeListJS){ //handle receipt of the route list
    routeList = JSON.parse(routeListJS);
    // notice how easy it is to parse the JSON into a structure
    // for illustration, here we extract the GUID of the first route
    firstGUID = routeList[0].GUID;
    }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_probing_opencpn"><a class="anchor" href="#_probing_opencpn"></a>Probing OpenCPN</h3>
<div class="paragraph">
<p>I have found the plugin an excellent way of probing OpenCPN
functionality, particularly as I can evolve the script in the light of
what I get, iteratively. Wondering what a route list looks like? This
will show you:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-code hljs" data-lang="code">OCPNonMessageName(handleRL, “OCPN_ROUTELIST_RESPONSE”);
OCPNsendMessage("OCPN_ROUTELIST_REQUEST", JSON.stringify({"mode": "Not track”}));

function handleRL(routeListJS){  // handle route list response
      print(routeListJS, “\n”);
    }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_more_examples"><a class="anchor" href="#_more_examples"></a>More examples</h3>
<div class="paragraph">
<p>See the user guide for details of all the APIs and more illustrative
applications.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.
     Sources: https://gitlab.com/leamas/antora-ui-default
  </p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
